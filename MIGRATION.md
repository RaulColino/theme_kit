# Migration Guide: Theme Kit 2.x to 3.0

This guide will help you migrate your project from Theme Kit 2.x (Mason-based) to Theme Kit 3.0 (CLI-based).

## Overview of Changes

Theme Kit 3.0 is a complete rewrite with a new architecture:

| Aspect | 2.x (Mason) | 3.0 (CLI) |
|--------|-------------|-----------|
| Installation | Mason CLI + brick | Dart package |
| Configuration | Interactive prompts | YAML file |
| Generation | `mason make theme_kit` | `dart run theme_kit:generate` |
| Output | Fixed structure | Customizable |
| Version control | No config file | YAML in git |

## Prerequisites

Before starting:

1. **Backup your project** - Commit all changes
2. **Note your current theme configuration** - You'll need to recreate it in YAML
3. **Check your imports** - You may need to update import paths

## Step-by-Step Migration

### Step 1: Document Current Configuration

Before removing Mason, document your current theme settings:

```
Theme name: _________
Prefix: _________
Font families: _________
Font weights: _________
Colors: _________
Text styles: _________
```

Take screenshots of your Mason prompts or save the output if possible.

### Step 2: Remove Mason Dependencies

#### Remove from pubspec.yaml

```yaml
# REMOVE these lines:
dev_dependencies:
  mason_cli: any
```

#### Uninstall Mason (optional)

If you're not using Mason for other projects:

```bash
dart pub global deactivate mason_cli
```

### Step 3: Install Theme Kit 3.0

#### Add to pubspec.yaml

```yaml
dev_dependencies:
  theme_kit: ^3.0.0
```

#### Install dependencies

```bash
flutter pub get
```

### Step 4: Create Configuration File

Create a `theme_kit.yaml` file in your project root with your documented configuration:

```yaml
# Basic configuration
name: my_theme        # Your theme name from step 1
prefix: mt            # Your prefix from step 1

# Optional description
description: My custom theme

# Font families (copy from your Mason configuration)
font_families:
  - Inter
  - Roboto

# Font weights (copy from your Mason configuration)
font_weights:
  - name: regular
    weight: 400
  - name: medium
    weight: 500
  - name: semibold
    weight: 600
  - name: bold
    weight: 700

# Colors (copy from your Mason configuration)
colors:
  primary:
    description: Primary brand color
  secondary:
    description: Secondary brand color
  success:
    description: Success state color
  warning:
    description: Warning state color
  error:
    description: Error state color
  background:
    description: Background color
  textPrimary:
    description: Primary text color
  textSecondary:
    description: Secondary text color

# Text styles (copy from your Mason configuration)
text_styles:
  - name: displayXL
    font_size: 48.0
  - name: displayL
    font_size: 36.0
  - name: headingL
    font_size: 28.0
  - name: bodyM
    font_size: 16.0
  - name: bodyS
    font_size: 14.0
```

### Step 5: Remove Old Generated Files

Remove the old theme package or files generated by Mason:

```bash
# If you had a separate theme package:
rm -rf packages/my_theme

# Or if files were generated in lib:
rm -rf lib/my_theme
```

**Important:** Make sure you've backed up any customizations you made to the generated files!

### Step 6: Generate New Theme

Run the new generator:

```bash
# Generate in default location (lib/theme)
dart run theme_kit:generate

# Or specify custom output
dart run theme_kit:generate --output lib/theme
```

You should see output like:

```
üé® Theme Kit v3.0.0
Generating theme from: theme_kit.yaml
Output directory: lib/theme

üìñ Loading configuration...
   Theme: my_theme
   Prefix: mt
üìÅ Creating output directories...
‚úçÔ∏è  Generating theme files...
   ‚úì mt_font_family.dart
   ‚úì mt_font_weight.dart
   ‚úì mt_text.dart
   ‚úì mt_theme.dart
   ‚úì mt_color.dart
   ‚úì my_theme.dart
   ‚úì my_theme.dart (main export)
   ‚úì USAGE.md

‚úÖ Theme generated successfully!
```

### Step 7: Update Import Paths

Update your imports throughout your app:

#### Before (2.x)

```dart
import 'package:my_theme/my_theme.dart';
// or
import 'my_theme/my_theme.dart';
```

#### After (3.0)

```dart
// If generated in lib/theme (default):
import 'theme/my_theme.dart';

// If generated in a different location:
import 'your_custom_path/my_theme.dart';
```

Use your IDE's "Find and Replace" to update all imports:

- Find: `package:my_theme/my_theme.dart`
- Replace: `theme/my_theme.dart`

### Step 8: Verify Generated Code

The generated code structure is similar but not identical:

#### Generated Files

2.x location ‚Üí 3.0 location:

```
packages/my_theme/lib/
  ‚îî‚îÄ‚îÄ src/
      ‚îú‚îÄ‚îÄ colors/           ‚Üí lib/theme/src/colors/
      ‚îú‚îÄ‚îÄ typography/       ‚Üí lib/theme/src/typography/
      ‚îî‚îÄ‚îÄ theme/            ‚Üí lib/theme/src/theme/
```

#### API Compatibility

The public API is mostly the same:

```dart
// ‚úÖ These work the same in 3.0:
MTTheme(primary: Colors.blue, ...)
MTColor.primary
MTText.bodyM('text')
MTFontWeight.bold
MyTheme(lightTheme: ..., child: ...)
```

### Step 9: Test Your Application

1. **Run the app:**
   ```bash
   flutter run
   ```

2. **Check for errors:**
   - Look for import errors
   - Look for missing colors or text styles
   - Test theme switching

3. **Verify visuals:**
   - Colors look correct
   - Text styles are applied properly
   - Theme switching works

### Step 10: Update CI/CD (if applicable)

If you have CI/CD pipelines:

#### Before (2.x)

```yaml
- name: Install Mason
  run: dart pub global activate mason_cli

- name: Initialize Mason
  run: mason init

- name: Add brick
  run: mason add theme_kit

- name: Generate theme
  run: mason make theme_kit
```

#### After (3.0)

```yaml
- name: Install dependencies
  run: flutter pub get

- name: Generate theme
  run: dart run theme_kit:generate
```

### Step 11: Update Documentation

Update your project's documentation:

1. **README.md** - Update setup instructions
2. **CONTRIBUTING.md** - Update development setup
3. **Comments** - Update any comments referencing Mason

### Step 12: Commit Changes

```bash
# Add the new configuration file
git add theme_kit.yaml

# Add updated pubspec.yaml
git add pubspec.yaml pubspec.lock

# Add generated files (or ensure they're in .gitignore)
git add lib/theme/

# Commit
git commit -m "Migrate from Theme Kit 2.x to 3.0"
```

## Common Issues During Migration

### Issue: Generated files in different location

**Problem:** Your imports don't work because files are in a different location.

**Solution:** Either:
1. Update all imports to the new location
2. Or regenerate with `--output` flag to match your old location:
   ```bash
   dart run theme_kit:generate --output packages/my_theme/lib
   ```

### Issue: Missing colors or styles

**Problem:** Some colors or text styles are missing.

**Solution:** Check your `theme_kit.yaml` - you may have forgotten to add them. Compare with your old Mason configuration.

### Issue: Different class names

**Problem:** Class names don't match.

**Solution:** This shouldn't happen if you use the same name and prefix. Verify:
- `name` in YAML matches your old theme name
- `prefix` in YAML matches your old prefix

### Issue: Compilation errors

**Problem:** App doesn't compile after migration.

**Solution:**
1. Run `flutter clean`
2. Run `flutter pub get`
3. Restart your IDE
4. Check for import errors

## Benefits After Migration

Once migrated, you'll enjoy:

‚úÖ **Simpler workflow** - No external tools to install
‚úÖ **Version control** - Configuration file in git
‚úÖ **Easier CI/CD** - Straightforward integration
‚úÖ **Better reproducibility** - Same config = same output
‚úÖ **Customizable output** - Generate wherever you want
‚úÖ **Better documentation** - YAML file documents your theme

## Rollback Plan

If you need to rollback:

1. **Restore from backup:**
   ```bash
   git checkout HEAD~1
   ```

2. **Or manually revert:**
   - Remove `theme_kit.yaml`
   - Restore `pubspec.yaml` to 2.x version
   - Restore old generated files
   - Reinstall Mason

## Need Help?

- [README.md](README.md) - General documentation
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - Common issues
- [API.md](API.md) - API reference
- [GitHub Issues](https://github.com/RaulColino/theme_kit/issues) - Report problems

## Migration Checklist

Use this checklist to track your migration:

- [ ] Backup project
- [ ] Document current theme configuration
- [ ] Remove Mason dependencies
- [ ] Install Theme Kit 3.0
- [ ] Create theme_kit.yaml
- [ ] Remove old generated files
- [ ] Generate new theme
- [ ] Update import paths
- [ ] Test application
- [ ] Update CI/CD
- [ ] Update documentation
- [ ] Commit changes
- [ ] Deploy and verify

## Example Migration

See the [example](example/) directory for a complete working example using Theme Kit 3.0.
